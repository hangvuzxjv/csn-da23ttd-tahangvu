<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bi·ªÉu ƒê·ªì Gi√° Th·ªßy S·∫£n</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="config.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-gray-50">
    <header class="sticky top-0 z-50 bg-white shadow-md">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <a href="index.html" class="flex items-center space-x-3 hover:opacity-90 transition"><img src="img/logo.png" alt="Logo" class="h-10 w-10"><span class="text-2xl font-bold text-teal-600">Th·ªßy S·∫£n</span></a>
            <nav class="hidden lg:flex space-x-8 text-base font-medium">
                <a href="index.html" class="text-gray-700 hover:text-teal-600 transition">Trang Ch·ªß</a>
                <a href="tintuc.html" class="text-gray-700 hover:text-teal-600 transition">Tin T·ª©c</a>
                <a href="kythuat.html" class="text-gray-700 hover:text-teal-600 transition">K·ªπ Thu·∫≠t</a>
                <a href="gia-thuy-san.html" class="text-teal-600 border-b-2 border-teal-600">Gi√° Th·ªßy S·∫£n</a>
            </nav>
            <div id="auth-buttons">
                <a href="dangnhap.html" class="text-sm font-medium text-gray-700 hover:text-teal-600 transition">ƒêƒÉng Nh·∫≠p</a>
            </div>
            <div id="user-profile" class="hidden relative">
                <button class="flex items-center space-x-2" id="user-menu-btn">
                    <div class="w-8 h-8 bg-teal-500 rounded-full flex items-center justify-center"><span class="text-white text-sm font-bold">U</span></div>
                    <span class="text-sm font-medium">user</span>
                </button>
                <div id="user-menu" class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50 hidden">
                    <a href="profile.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">üë§ Profile</a>
                    <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" onclick="logout()">üö™ ƒêƒÉng Xu·∫•t</a>
                </div>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-10">
        <h1 class="text-4xl font-extrabold text-gray-800 mb-2">üìä Bi·ªÉu ƒê·ªì Gi√° Th·ªßy S·∫£n</h1>
        <p class="text-gray-600 mb-8">Theo d√µi bi·∫øn ƒë·ªông gi√° th·ªßy s·∫£n t·∫°i Tr√† Vinh</p>

        <div class="bg-white p-6 rounded-xl shadow-lg mb-8">
            <div class="flex gap-4 mb-6">
                <select id="species-select" class="border border-gray-300 rounded-lg p-2">
                    <option value="T√¥m Th·∫ª">T√¥m Th·∫ª</option>
                    <option value="C√° Tra">C√° Tra</option>
                    <option value="T√¥m S√∫">T√¥m S√∫</option>
                </select>
                <select id="days-select" class="border border-gray-300 rounded-lg p-2">
                    <option value="7">7 ng√†y</option>
                    <option value="30" selected>30 ng√†y</option>
                    <option value="90">90 ng√†y</option>
                </select>
                <button onclick="loadPriceChart()" class="px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700">C·∫≠p nh·∫≠t</button>
            </div>
            <canvas id="priceChart" height="80"></canvas>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="bg-white p-6 rounded-xl shadow-lg text-center">
                <h3 class="text-lg font-bold text-gray-800 mb-2">Gi√° H√¥m Nay</h3>
                <p id="today-price" class="text-3xl font-extrabold text-teal-600">---</p>
                <p class="text-sm text-gray-400">VNƒê/kg</p>
            </div>
            <div class="bg-white p-6 rounded-xl shadow-lg text-center">
                <h3 class="text-lg font-bold text-gray-800 mb-2">Cao Nh·∫•t</h3>
                <p id="max-price" class="text-3xl font-extrabold text-green-600">---</p>
                <p class="text-sm text-gray-400">VNƒê/kg</p>
            </div>
            <div class="bg-white p-6 rounded-xl shadow-lg text-center">
                <h3 class="text-lg font-bold text-gray-800 mb-2">Th·∫•p Nh·∫•t</h3>
                <p id="min-price" class="text-3xl font-extrabold text-red-600">---</p>
                <p class="text-sm text-gray-400">VNƒê/kg</p>
            </div>
        </div>
    </main>

    <script src="script.js"></script>
    <script>
        let priceChart = null;

        async function loadPriceChart() {
            const species = document.getElementById('species-select').value;
            const days = document.getElementById('days-select').value;
            
            try {
                const url = window.apiUrl ? apiUrl(`db.php/get_price_chart.php?species=${species}&days=${days}`) : `/Project/db.php/get_price_chart.php?species=${species}&days=${days}`;
                const response = await fetch(url);
                const result = await response.json();
                
                if (result.success && result.data.length > 0) {
                    const labels = result.data.map(d => d.recorded_at);
                    const prices = result.data.map(d => parseFloat(d.price));
                    
                    // C·∫≠p nh·∫≠t th·ªëng k√™
                    document.getElementById('today-price').textContent = prices[prices.length - 1].toLocaleString();
                    document.getElementById('max-price').textContent = Math.max(...prices).toLocaleString();
                    document.getElementById('min-price').textContent = Math.min(...prices).toLocaleString();
                    
                    // V·∫Ω bi·ªÉu ƒë·ªì
                    const ctx = document.getElementById('priceChart').getContext('2d');
                    
                    if (priceChart) priceChart.destroy();
                    
                    priceChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'Gi√° ' + species + ' (VNƒê/kg)',
                                data: prices,
                                borderColor: '#0d9488',
                                backgroundColor: 'rgba(13, 148, 136, 0.1)',
                                tension: 0.4,
                                fill: true
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: { display: true },
                                title: { display: true, text: 'Bi·∫øn ƒê·ªông Gi√° ' + species }
                            },
                            scales: {
                                y: { beginAtZero: false }
                            }
                        }
                    });
                }
            } catch (error) {
                console.error('L·ªói:', error);
            }
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            loadPriceChart();
        });
    </script>
</body>
</html>
